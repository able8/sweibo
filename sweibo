#!/bin/bash

export CONFIG_DIR="$HOME/.sweibo"
export AUTH_FILE="$CONFIG_DIR/auth"
if [[ ! ( -d $CONFIG_DIR ) ]]; then
    mkdir CONFIG_DIR
fi

function print_usage()
{
    echo "Usage: TODO"
}

function clean()
{
    rm -rf $CONFIG_DIR/*
}

function auth()
{
    ./auth $AUTH_FILE
}

function get_access_token()
{
    ACCESS_TOKEN=$(awk '$1=="access_token" {print $2}' $AUTH_FILE)
    # TODO Validate
}

export ACCESS_TOKEN
get_access_token
while [ -z $ACCESS_TOKEN ];
do
    auth
    get_access_token
done
printf "Access token loaded: %s\n" $ACCESS_TOKEN

case $1 in
    clean)
        clean $@;;
    auth)
        auth;;
    *)
        print_usage;;
esac

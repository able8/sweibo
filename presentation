#!/bin/bash

function display_user_brief() {
    local data=$1
    local name=$(echo "$data" | jq -r ".screen_name")
    local id=$(echo "$data" | jq -r ".id")
    echo -en "User: \e[36m$name\e[0m"
    local description=$(echo "$data" | jq -r ".description")
    echo -en " - $description\n\n"
}

function display_user {
    local data=$1
}

function display_status {
    cols=$(tput cols)

    local data=$1
    local user_data=$(echo "$data" | jq ".user")
    display_user_brief "$user_data"
    echo -en "\e[1m"
    # delete U+200B at end of message
    echo "$data" | jq -r ".text" | sed 's/^/    /g' | sed 's/\xe2\x80\x8b$//g'
    echo -en "\e[0m"

    
    local original_pic=$(echo "$data" | jq -r ".original_pic")
    local pic=$(echo "$data" | jq -r ".thumbnail_pic")
    if [ "$pic" != null ]; then
        local pic_width
        let "pic_width = cols / 2"
        echo "    Picture: $original_pic"
        temp_file=$(mktemp)
        curl -s "$pic" -o $temp_file
        if [ -f "/usr/bin/catimg" ]; then
            catimg -w $pic_width $temp_file | sed 's/^/            /g'
        elif [ -f "$SWEIBO_DIR/catimg" ]; then
            "$SWEIBO_DIR/catimg" -w $pic_width $temp_file | sed 's/^/            /g'
        fi
        rm "$temp_file"
    fi

    local date=$(echo "$data" | jq -r ".created_at")
    printf "\n%${cols}s\n" "Created at $date"
}

function display_comment {
    :
}